# app çš„å”¯ä¸€ id,ä¸Šæ¶åˆ°å•†åº—éœ€è¦ä¿è¯ä¸è¦å†²çª,å°½é‡ä½¿ç”¨å¼€å‘è€…è‡ªå·±çš„åŸŸåä½œä¸ºåç¼€.
package: cloud.lazycat.app.liu.zitadel
# app çš„ç‰ˆæœ¬
version: 4.3.1

name: zitadel
keyword: identity,iam,auth,zitadel
description: Open-source identity and access management platform for modern applications.

# è½¯ä»¶åç§°,ä¼šæ˜¾ç¤ºåœ¨å¯åŠ¨å™¨ä¹‹ç±»çš„åœ°æ–¹
locales:
  zh:
    name: Zitadel èº«ä»½å¹³å°
    description: |
      ## Zitadel èº«ä»½ä¸è®¿é—®ç®¡ç†

      **å®˜æ–¹ç½‘ç«™ï¼š** https://zitadel.com/
      **ä»“åº“åœ°å€ï¼š** https://github.com/lazycatapps/zitadel.git

      Zitadel æ˜¯ä¸€ä¸ªå¼€æºçš„èº«ä»½ä¸è®¿é—®ç®¡ç†å¹³å°ï¼ˆIAMï¼‰ï¼Œä¸ºç°ä»£åº”ç”¨ç¨‹åºæä¾›ä¼ä¸šçº§çš„è®¤è¯å’Œæˆæƒè§£å†³æ–¹æ¡ˆã€‚å®ƒæ”¯æŒå¤šç§Ÿæˆ·æ¶æ„ï¼Œæä¾›å®Œæ•´çš„ OAuth 2.0ã€OpenID Connect (OIDC)ã€SAML 2.0 ç­‰æ ‡å‡†åè®®ï¼Œå¸®åŠ©å›¢é˜Ÿå¿«é€Ÿæ„å»ºå®‰å…¨å¯é çš„ç™»å½•ä¸æˆæƒä½“ç³»ã€‚

      ## ä¸»è¦åŠŸèƒ½

      - ğŸ” **å¤šåè®®æ”¯æŒ**ï¼šOAuth 2.0ã€OpenID Connectã€SAML 2.0
      - ğŸ‘¥ **å¤šç§Ÿæˆ·æ¶æ„**ï¼šæ”¯æŒå¤šç»„ç»‡ã€å¤šé¡¹ç›®çš„ç‹¬ç«‹ç®¡ç†
      - ğŸ¨ **è‡ªå®šä¹‰ç™»å½•ç•Œé¢**ï¼šæä¾› Login UI v2ï¼Œæ”¯æŒå“ç‰Œå®šåˆ¶
      - ğŸ”‘ **å¤šå› ç´ è®¤è¯**ï¼šæ”¯æŒ TOTPã€WebAuthnã€çŸ­ä¿¡ç­‰å¤šç§è®¤è¯æ–¹å¼
      - ğŸ‘¤ **ç”¨æˆ·ç®¡ç†**ï¼šå®Œæ•´çš„ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œæƒé™æ§åˆ¶
      - ğŸ“Š **å®¡è®¡æ—¥å¿—**ï¼šè¯¦ç»†çš„æ“ä½œå®¡è®¡å’Œå®‰å…¨äº‹ä»¶è¿½è¸ª
      - ğŸ”Œ **API ä¼˜å…ˆ**ï¼šæä¾›å®Œæ•´çš„ REST å’Œ gRPC API
      - ğŸŒ **å›½é™…åŒ–æ”¯æŒ**ï¼šæ”¯æŒå¤šè¯­è¨€ç•Œé¢
      - ğŸš€ **é«˜æ€§èƒ½**ï¼šåŸºäº Go è¯­è¨€å¼€å‘ï¼Œæ€§èƒ½å“è¶Š
      - ğŸ“± **ç§»åŠ¨å‹å¥½**ï¼šæ”¯æŒç§»åŠ¨åº”ç”¨çš„è®¤è¯é›†æˆ

      ## é»˜è®¤è´¦å·ä¿¡æ¯

      - **é»˜è®¤ç®¡ç†å‘˜è´¦å·**ï¼š`admin@lazycat.{åº”ç”¨åŸŸå}` ï¼ˆä¾‹å¦‚ï¼š`admin@lazycat.zitadel.${LAZYCAT_BOX_NAME}.heiyu.space`ï¼‰
      - **é»˜è®¤å¯†ç **ï¼š`Admin@123456`
      - **é»˜è®¤ç»„ç»‡åç§°**ï¼š`Lazycat`

      âš ï¸ **é‡è¦**ï¼š
      - ç™»å½•ç”¨æˆ·åä¼šè‡ªåŠ¨æ·»åŠ  `@ç»„ç»‡å.åŸŸå` åç¼€
      - é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ä»¥ç¡®ä¿å®‰å…¨ï¼

      ## ä½¿ç”¨åœºæ™¯

      - ä¼ä¸šå•ç‚¹ç™»å½• (SSO)
      - å¤šç§Ÿæˆ· SaaS åº”ç”¨è®¤è¯
      - API è®¿é—®æ§åˆ¶
      - å¾®æœåŠ¡å®‰å…¨ç½‘å…³
      - B2B/B2C èº«ä»½ç®¡ç†
  en:
    name: Zitadel
    description: |
      ## Zitadel Identity and Access Management

      **Official Site:** https://zitadel.com/
      **Repository:** https://github.com/lazycatapps/zitadel.git

      Zitadel is an open-source identity and access management (IAM) platform that provides enterprise-grade authentication and authorization solutions for modern applications. It supports multi-tenant architecture and delivers complete OAuth 2.0, OpenID Connect (OIDC), and SAML 2.0 standard protocols, enabling teams to rapidly build secure and reliable login and authorization systems.

      ## Key Features

      - ğŸ” **Multi-Protocol Support**: OAuth 2.0, OpenID Connect, SAML 2.0
      - ğŸ‘¥ **Multi-Tenant Architecture**: Independent management of multiple organizations and projects
      - ğŸ¨ **Custom Login Interface**: Provides Login UI v2 with brand customization
      - ğŸ”‘ **Multi-Factor Authentication**: Supports TOTP, WebAuthn, SMS, and other authentication methods
      - ğŸ‘¤ **User Management**: Complete user lifecycle management and access control
      - ğŸ“Š **Audit Logging**: Detailed operation audit and security event tracking
      - ğŸ”Œ **API First**: Provides complete REST and gRPC APIs
      - ğŸŒ **Internationalization**: Multi-language interface support
      - ğŸš€ **High Performance**: Built with Go language for exceptional performance
      - ğŸ“± **Mobile Friendly**: Supports authentication integration for mobile applications

      ## Default Credentials

      - **Default Admin Username**: `admin@lazycat.{app-domain}` (e.g., `admin@lazycat.zitadel.${LAZYCAT_BOX_NAME}.heiyu.space`)
      - **Default Password**: `Admin@123456`
      - **Default Organization Name**: `Lazycat`

      âš ï¸ **Important**:
      - The login username will automatically append `@org-name.domain` suffix
      - Please change the default password immediately after first login to ensure security!

      ## Use Cases

      - Enterprise Single Sign-On (SSO)
      - Multi-tenant SaaS application authentication
      - API access control
      - Microservices security gateway
      - B2B/B2C identity management

# è½¯ä»¶æœ¬èº«çš„ license
license: https://github.com/zitadel/zitadel?tab=AGPL-3.0-1-ov-file

# è½¯ä»¶çš„ä¸»é¡µ,ä¼šåœ¨å•†åº—ç­‰åœ°æ–¹ä½“ç°
homepage: https://zitadel.com/

# lpk çš„ä½œè€…,ä¼šåœ¨å•†åº—ç­‰åœ°æ–¹ä½“ç°
author: liu

ext_config:
  disable_grpc_web_on_root: true # ä¸åŠ«æŒ grpc-web æµé‡ (é…åˆæ–°ç‰ˆ sdk)

# application ä½œä¸ºä¸€ä¸ªç‰¹æ®Šçš„ container è¿è¡Œï¼Œå¯¹åº”çš„ service åç§°ä¸ºå›ºå®šçš„`app`ï¼Œ å…¶ä»– service å¯ä»¥é€šè¿‡æ­¤åç§°ä¸ app è¿›è¡Œé€šè®¯
application:
  #æ˜¯å¦å­˜åœ¨åå°ä»»åŠ¡ï¼Œ è‹¥å­˜åœ¨åˆ™ç³»ç»Ÿä¸ä¼šå¯¹æ­¤ app è¿›è¡Œä¸»åŠ¨ä¼‘çœ ç­‰æ“ä½œ
  background_task: true

  # æœŸæœ›çš„ app åŸŸåï¼Œå¦‚æœç³»ç»Ÿä¸­å·²ç»æœ‰å¯¹åº”åŸŸååˆ™ä¼šæç¤ºç”¨æˆ·é€‰æ‹©å…¶ä»–åŸŸåã€‚ æœ€ç»ˆ app åˆ†é…åˆ°çš„åŸŸåä»¥/lzcapp/run/app.subdomain ä¸ºå‡†
  subdomain: zitadel

  # æ²¡æœ‰ä½¿ç”¨ routes æ˜¯å› ä¸ºéœ€è¦æŠŠç”¨æˆ·è®¿é—®çš„ host ä¼ é€’ç»™ zitadel
  upstreams:
    - location: /ui/v2/login/
      backend: http://login:3000/ui/v2/login/
      use_backend_host: false
    - location: /
      backend: http://zitadel:8080
      use_backend_host: false

  public_path:
    - /                         # æ— éœ€ç™»å½•å³å¯è®¿é—®

  depends_on:
    - zitadel

  # æ˜¯å¦å¯ç”¨å¤šå®ä¾‹
  multi_instance: false

services:
  zitadel:
    # lzc-cli appstore copy-image ghcr.io/zitadel/zitadel:latest
    image: registry.lazycat.cloud/liu/zitadel/zitadel:6d88cd0b7fbc4535
    user: root
    command: start-from-init --masterkey "MasterkeyNeedsToHave32Characters"
    environment:
      - ZITADEL_EXTERNALPORT=443
      - ZITADEL_EXTERNALDOMAIN=${LAZYCAT_APP_DOMAIN}
      - ZITADEL_EXTERNALSECURE=true
      - ZITADEL_EXTERNALPROTOCOL=https
      - ZITADEL_TLS_ENABLED=false
      - ZITADEL_DATABASE_POSTGRES_HOST=db
      - ZITADEL_DATABASE_POSTGRES_PORT=5432
      - ZITADEL_DATABASE_POSTGRES_DATABASE=zitadel
      - ZITADEL_DATABASE_POSTGRES_ADMIN_USERNAME=postgres
      - ZITADEL_DATABASE_POSTGRES_ADMIN_PASSWORD=postgres
      - ZITADEL_DATABASE_POSTGRES_ADMIN_SSL_MODE=disable
      - ZITADEL_DATABASE_POSTGRES_USER_USERNAME=zitadel
      - ZITADEL_DATABASE_POSTGRES_USER_PASSWORD=zitadel
      - ZITADEL_DATABASE_POSTGRES_USER_SSL_MODE=disable
      - ZITADEL_FIRSTINSTANCE_ORG_NAME=Lazycat
      - ZITADEL_FIRSTINSTANCE_ORG_HUMAN_USERNAME=admin@lazycat.${LAZYCAT_APP_DOMAIN}
      - ZITADEL_FIRSTINSTANCE_ORG_HUMAN_PASSWORD=Admin@123456
      - ZITADEL_FIRSTINSTANCE_ORG_HUMAN_PASSWORDCHANGEREQUIRED=false
      - ZITADEL_FIRSTINSTANCE_LOGINCLIENTPATPATH=/current-dir/login-client.pat
      - ZITADEL_FIRSTINSTANCE_ORG_LOGINCLIENT_MACHINE_USERNAME=login-client
      - ZITADEL_FIRSTINSTANCE_ORG_LOGINCLIENT_MACHINE_NAME=Automatically Initialized IAM_LOGIN_CLIENT
      - ZITADEL_FIRSTINSTANCE_ORG_LOGINCLIENT_PAT_EXPIRATIONDATE=2029-01-01T00:00:00Z
      - ZITADEL_DEFAULTINSTANCE_FEATURES_LOGINV2_REQUIRED=true
      - ZITADEL_DEFAULTINSTANCE_FEATURES_LOGINV2_BASEURI=https://${LAZYCAT_APP_DOMAIN}/ui/v2/login
      - ZITADEL_OIDC_DEFAULTLOGINURLV2=https://${LAZYCAT_APP_DOMAIN}/ui/v2/login/login?authRequest=
      - ZITADEL_OIDC_DEFAULTLOGOUTURLV2=https://${LAZYCAT_APP_DOMAIN}/ui/v2/login/logout?post_logout_redirect=
      - ZITADEL_SAML_DEFAULTLOGINURLV2=https://${LAZYCAT_APP_DOMAIN}/ui/v2/login/login?samlRequest=
      - ZITADEL_LOG_LEVEL=debug
      - ZITADEL_LOGSTORE_ACCESS_STDOUT_ENABLED=true
    depends_on:
      - db
    binds:
      - /lzcapp/var/current-dir:/current-dir
    health_check:
      test:
        - CMD
        - /app/zitadel
        - ready
      start_period: 10s

  login:
    # lzc-cli appstore copy-image ghcr.io/zitadel/zitadel-login:latest
    image: registry.lazycat.cloud/liu/zitadel/zitadel-login:586b0085139187a3
    user: root
    environment:
      - ZITADEL_API_URL=https://${LAZYCAT_APP_DOMAIN}
      - NEXT_PUBLIC_BASE_PATH=/ui/v2/login
      - ZITADEL_SERVICE_USER_TOKEN_FILE=/current-dir/login-client.pat
    depends_on:
      - zitadel
    binds:
      - /lzcapp/var/current-dir:/current-dir

  db:
    # lzc-cli appstore copy-image postgres:17-alpine
    image: registry.lazycat.cloud/liu/library/postgres:cf54e1c33a8a3b2d
    environment:
      - PGUSER=postgres
      - POSTGRES_PASSWORD=postgres
    binds:
      - /lzcapp/var/data:/var/lib/postgresql/data
    health_check:
      test:
        - CMD-SHELL
        - pg_isready -d zitadel -U postgres
      start_period: 20s
